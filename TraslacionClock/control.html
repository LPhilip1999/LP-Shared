<!DOCTYPE html>
<html lang="en">
<head>
    <title>Traslacion 2026 Manual Controller</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <style>
        #protected-content { display: none; }
        body { font-family: sans-serif; text-align: center; padding: 30px; background: #1a1a1a; color: white; }
        .control-box { background: #333; padding: 20px; border-radius: 10px; display: inline-block; }
        input[type="datetime-local"] { font-size: 18px; padding: 10px; margin: 10px; border-radius: 5px; }
        button { font-size: 18px; padding: 12px 25px; margin: 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .btn-set { background: #007bff; color: white; }
        .btn-stop { background: #dc3545; color: white; }
        .btn-reset { background: #6c757d; color: white; }
        .status { margin: 15px; font-size: 1.2em; color: #ffc107; }
    </style>
</head>
<body>
    <div id="protected-content">
        <h1>Traslacion 2026 Manual Entry</h1>
        <div class="control-box">
            <p>Enter the Exact Start Time of the Procession:</p>
            <input type="datetime-local" id="startTimeInput">
            <br>
            <button class="btn-set" onclick="startManualTimer()">SYNC & START</button>
            <button class="btn-stop" onclick="stopTimer()">STOP/FREEZE</button>
            <button class="btn-reset" onclick="resetToZero()">RESET TO ZERO</button>
        </div>
        <div class="status" id="status">Status: Waiting for cloud sync...</div>
        <h2 id="localDisplay">00:00:00</h2>
    </div>

    <script>
        // --- FIREBASE INITIALIZATION ---
        // REPLACE THIS WITH YOUR CONFIG FROM FIREBASE CONSOLE
        const firebaseConfig = {
            apiKey: "AIzaSyChe-th-e1RQJGnRxdIcpKgJ2AuIsILjTQ",
            authDomain: "traslacion-clock-2026.firebaseapp.com",
            databaseURL: "https://traslacion-clock-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "traslacion-clock-2026",
            storageBucket: "traslacion-clock-2026.firebasestorage.app",
            appId: "1:506370432562:web:3ae603fce823dfa59ba62b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- PASSCODE PROTECTION ---
        const passcode = "2026"; 
        const userEntry = prompt("Enter passcode to access timer controls:");
        if (userEntry === passcode) {
            document.getElementById('protected-content').style.display = 'block';
        } else {
            alert("Incorrect passcode.");
            document.body.innerHTML = "<h1>Unauthorized Access</h1>";
        }

        const startTimeInput = document.getElementById('startTimeInput');
        let localInterval = null;

        // SYNC & START: Push to Cloud
        function startManualTimer() {
            const inputVal = startTimeInput.value;
            if (!inputVal) return alert("Please select a date and time!");
            const startTimeMs = new Date(inputVal).getTime();
            
            db.ref('traslacion').set({
                startTime: startTimeMs,
                isRunning: true,
                savedInput: inputVal
            });
            document.getElementById('status').innerText = "Status: Live (Synced to Cloud)";
        }

        // STOP: Tell Cloud to stop
        function stopTimer() {
            db.ref('traslacion/isRunning').set(false);
            document.getElementById('status').innerText = "Status: Frozen in Cloud";
        }

        // RESET: Set Cloud values to 0
        function resetToZero() {
            db.ref('traslacion').set({
                startTime: 0,
                isRunning: false,
                savedInput: ""
            });
            document.getElementById('status').innerText = "Status: Reset Globally";
        }

        // --- CLOUD LISTENER FOR LOCAL PREVIEW ---
        db.ref('traslacion').on('value', (snapshot) => {
            const data = snapshot.val();
            if (localInterval) clearInterval(localInterval);
            
            if (data && data.isRunning) {
                startTimeInput.value = data.savedInput || "";
                localInterval = setInterval(() => {
                    const now = new Date().getTime();
                    let diff = Math.floor((now - data.startTime) / 1000);
                    updateLocalDisplay(diff < 0 ? 0 : diff);
                }, 1000);
            } else {
                updateLocalDisplay(0);
            }
        });

        function updateLocalDisplay(totalSeconds) {
            const hrs = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const mins = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const secs = (totalSeconds % 60).toString().padStart(2, '0');
            document.getElementById('localDisplay').innerText = `${hrs}:${mins}:${secs}`;
        }
    </script>
</body>
    </html>
